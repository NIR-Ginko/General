#----------------------------------------------------------------------------
# Copyright (C) 2002 ООО "НИП-Информатика"
#----------------------------------------------------------------------------
# АВТОР     Юрий Романченко
# СОЗДАНО   5 сентября 2002 г.
# ОПИСАНИЕ  Константы, переменные и макросы для генераторов документов
#           в формате RTF
#----------------------------------------------------------------------------
# СПИСОК ИЗМЕНЕНИЙ
#----------------------------------------------------------------------------


ФОРМАТ '????#'


#----------------------------------------------------------------------------
# Расширенный список логических констант
#----------------------------------------------------------------------------

ВЕЩ NULL = -1
ВЕЩ TRUE = 1
ВЕЩ FALSE = 0


#----------------------------------------------------------------------------
# Часто используемые ключевые слова RTF
#----------------------------------------------------------------------------

СТРОКА PAR='\par'
СТРОКА TAB='\tab '
СТРОКА CEL='\cell'
СТРОКА ROW='{\row}'


#----------------------------------------------------------------------------
# Часто используемые константы
#----------------------------------------------------------------------------

ВЕЩ MM2TWIPS = 1440 / 25.4        # Перевод мм -> twips
ВЕЩ FAT = 30                      # Толщина жирной границы
ВЕЩ THIN = 15                     # Толщина тонкой границы


#----------------------------------------------------------------------------
# МАКРО rtfНачФайла
# ЦЕЛЬ  Формирование начала RTF файла
# ВХОД  -
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfНачФайла
   ВЫВОДСТР '{\rtf1\ansi'
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfКонФайла
# ЦЕЛЬ  Формирование конца RTF файла
# ВХОД  -
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfКонФайла
   ВЫВОДСТР '}'
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfШрифты
# ЦЕЛЬ  Формирование таблицы шрифтов
# ВХОД  -
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfШрифты
   ВЫВОДСТР '{\fonttbl'
   ВЫВОДСТР '{\f0\fcharset204 Times New Roman;}'
   ВЫВОДСТР '}'
КОНМАК


#----------------------------------------------------------------------------
# Используемые в документе стили
#----------------------------------------------------------------------------

СТРОКА sNORM   ='\fs20\lang1049'             # обычный текст
СТРОКА sTITLE  ='\s18 \qc\sa240 \fs32'       # заголовок документа
СТРОКА sFIELD  ='\s19 \tx2300 \fs20'         # одиночные данные
СТРОКА sTABNAME='\s20 \sb240 \b\fs24'        # заголовок таблицы
СТРОКА sHEADER ='\s21 \intbl \qc \b\fs20'    # шапка таблицы
СТРОКА sCELL   ='\s22 \intbl \fs20'          # ячейка таблицы


#----------------------------------------------------------------------------
# МАКРО rtfСтили
# ЦЕЛЬ  Формирование таблицы стилей
# ВХОД  Описания используемых стилей:
#       sNORM, sTITLE, sFIELD, sTABNAME, sHEADER, sCELL
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfСтили
   ВЫВОДСТР '{\stylesheet'
   ВЫВОДСТР '{', sNORM, ' Normal;}'
   ВЫВОДСТР '{\*\cs10 \additive Default Paragraph Font;}'
   ВЫВОДСТР '{', sTITLE, ' \sbasedon0 TITLE;}'
   ВЫВОДСТР '{', sFIELD, ' \sbasedon0 FIELD;}'
   ВЫВОДСТР '{', sTABNAME, ' \sbasedon0 TABLE_NAME;}'
   ВЫВОДСТР '{', sHEADER, ' \sbasedon0 TABLE_HEADER;}'
   ВЫВОДСТР '{', sCELL, ' \sbasedon0 TABLE_CELL;}'
   ВЫВОДСТР '}'
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfСтиль
# ЦЕЛЬ  Активация стиля абзаца
# ВХОД  's' - имя текстовой переменной, содержащей описание стиля
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfСтиль( 's'='sNORM' )
   ВЫВОДСТР '\pard\plain ', &s
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfКолонки
# ЦЕЛЬ  Формирование описания многоколоночного раздела
# ВХОД  'N' - количество колонок
#       'gap' - расстояние между колонками, мм
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfКолонки( 'N'='1', 'gap'='5' )
   ВЫВОДСТР '{\pard\plain \sect}'
   ВЫВОД '\sectd \sbknone'
         ЕСЛИ (&N <> 1) ВЫВОД '\cols', &N, '\colsx', &gap*MM2TWIPS
         ВЫВОДСТР ''
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfСтрока
# ЦЕЛЬ  Формирование описания строки таблицы.
# ВХОД  'bL', 'bR', 'bT', 'bB', 'bM' - толщины линий границ ячеек строки
#          слева, справа, сверху, снизу и внутри соответственно, twips.
#       'W' - массив ширин столбцов, мм.
#          Отрицательная ширина столбца означает возможность вертикального
#          объединения ячеек этого столбца.
#       'N' - количество столбцов.
#       'first' - вертикальное объединение ячеек:
#          NULL = не производить объединение;
#          TRUE = первая строка в последовательности;
#          FALSE = следующая строка в последовательности.
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfСтрока( 'bL'='FAT', 'bR'='FAT', 'bT'='FAT', 'bB'='FAT', 'bM'='THIN', %
                 'W'='', 'N'='', 'first'='NULL' )
   ВЫВОДСТР '\trowd \trgaph108'
   ВЕЩ Колонка
   ВЕЩ x = 0
   ПОВТОР Колонка=1,&N
      ЕСЛИ (&W(Колонка) < 0  ЛИ  &first <> NULL) ТО
         ВЫВОДСТР (&first = TRUE) ? '\clvmgf' : '\clvmrg'
      КОНЕСЛИ
      ВЫВОДСТР '\clbrdrt\brdrs\brdrw', &bT
      ВЫВОДСТР '\clbrdrb\brdrs\brdrw', &bB
      ВЫВОДСТР '\clbrdrl\brdrs\brdrw', (Колонка =  1) ? &bL : &bM
      ВЫВОДСТР '\clbrdrr\brdrs\brdrw', (Колонка = &N) ? &bR : &bM
      x = x + АБС(&W(Колонка))
      ВЫВОДСТР '\cellx', ЦЕЛ(x*MM2TWIPS)
   КОНЦИКЛ
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfШапка
# ЦЕЛЬ  Формирование описания строки шапки таблицы.
# ВХОД  'bL', 'bR', 'bT', 'bB', 'bM' - толщины линий границ ячеек строки
#          слева, справа, сверху, снизу и внутри соответственно, twips.
#       'W' - массив ширин столбцов, мм.
#          Отрицательная ширина столбца означает возможность вертикального
#          объединения ячеек этого столбца.
#       'N' - количество столбцов.
#       'first' - вертикальное объединение ячеек:
#          NULL = не производить объединение;
#          TRUE = первая строка в последовательности;
#          FALSE = следующая строка в последовательности.
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfШапка( 'bL'='FAT', 'bR'='FAT', 'bT'='FAT', 'bB'='FAT', 'bM'='THIN', %
                'W'='', 'N'='', 'first'='NULL' )
   ВЫЗОВ rtfСтрока( 'bL'='&bL', 'bR'='&bR', 'bT'='&bT', 'bB'='&bB', 'bM'='&bM', %
                    'W'='&W', 'N'='&N', 'first'='&first' )
   ВЫВОДСТР '\trhdr'
   ВЫЗОВ rtfСтиль( 's'='sHEADER' )
КОНМАК


#----------------------------------------------------------------------------
# МАКРО rtfТело
# ЦЕЛЬ  Формирование описания строки тела таблицы.
# ВХОД  'bL', 'bR', 'bT', 'bB', 'bM' - толщины линий границ ячеек строки
#          слева, справа, сверху, снизу и внутри соответственно, twips.
#          По умолчанию нижняя граница последней строки делается жирной,
#          а для остальных строк - тонкой. Для определения типа строки
#          используются переменные текущего итератора таблицы
#       НомерСтроки и ЧислоСтрок.
#       'W' - массив ширин столбцов, мм.
#          Отрицательная ширина столбца означает возможность вертикального
#          объединения ячеек этого столбца.
#       'N' - количество столбцов.
#       'first' - вертикальное объединение ячеек:
#          NULL = не производить объединение;
#          TRUE = первая строка в последовательности;
#          FALSE = следующая строка в последовательности.
# ВЫХОД -
#----------------------------------------------------------------------------

МАКРО rtfТело( 'bL'='FAT', 'bR'='FAT', 'bT'='THIN', %
               'bB'='(НомерСтроки=ЧислоСтрок)?FAT:THIN', 'bM'='THIN', %
               'W'='', 'N'='', 'first'='NULL' )
   ВЫЗОВ rtfСтрока( 'bL'='&bL', 'bR'='&bR', 'bT'='&bT', 'bB'='&bB', 'bM'='&bM', %
                    'W'='&W', 'N'='&N', 'first'='&first' )
   ВЫЗОВ rtfСтиль( 's'='sCELL' )
КОНМАК
